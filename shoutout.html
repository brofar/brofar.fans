<html>

<head>
  <title>Streamer.bot Shout out player</title>

  <script>
    // Source code from: https://www.vrflad.com/shoutouthd.html

    function showVideo() {
      const urlParams = new URLSearchParams(window.location.search);
      const video = urlParams.get('video');
      const thumbnailUrl = urlParams.get('thumbnail_url');

      // Get the video source from the thumbnail url
      const videoSrc = thumbnailUrl.replace(/(.*)-preview-.*/, '$1.mp4');

      const videoElement = document.getElementById('videoplayer');
      videoElement.src = videoSrc;
    }

    function shoutout() {
      let firstrun = true;

      // parse url params
      const urlParams = new URLSearchParams(window.location.search);
      const user = urlParams.get('user');
      const image = urlParams.get('image');
      const video = urlParams.get('video');
      const time = urlParams.get('time');
      const thumbnailUrl = urlParams.get('thumbnail_url');

      // show avatar for a sec then show video
      // document.getElementById('imagebox2').innerHTML = "<img src='" + image + "' style='width:100%'/>";
      // setTimeout('showVideo()', 1000);

      showVideo();
    }
    function cleanup() {
      document.getElementById('videocontainer').innerHTML = "";
      document.getElementById('imagebox2').innerHTML = "";
    }

    const video = document.getElementById('videoplayer');
    video.addEventListener("error", (event) => {
      // Code to be executed if an error occurs
      console.error("An error occurred while loading the video: " + video.error.message);
    });
    video.addEventListener("abort", (event) => {
      // Code to be executed if an error occurs
      console.error("An error occurred while loading the video: " + video.error.message);
    });
    video.addEventListener("loadstart", (event) => {
      // Code to be executed when the browser starts loading the video
      console.log("The browser starts loading the video: " + video.src);
    });
    video.addEventListener("loadeddata", (event) => {
      // Code to be executed when the video is loaded and ready to play
      console.log("Video loaded and ready to play: " + video.src);
    });
    video.addEventListener("canplay", (event) => {
      // Code to be executed when the browser can start playing the video
      console.log("The browser can start playing the video: " + video.src);
    });
    video.addEventListener("playing", (event) => {
      // Code to be executed when the video is playing
      console.log("The video is playing: " + video.src);
    });
    video.addEventListener("ended", (event) => {
      // Code to be executed when the video has ended
      console.log("The video has ended: " + video.src);
      setTimeout('cleanup()',500);
    });
    video.addEventListener("waiting", (event) => {
      // Code to be executed when the video stops because it needs to buffer the next frame
      console.log("The video stops because it needs to buffer the next frame: " + video.src);
    });
    video.addEventListener("stalled", (event) => {
      // Code to be executed when the browser is trying to get media data, but data is not available
      console.log("The browser is trying to get media data, but data is not available: " + video.src);
    });

    
    document.addEventListener("DOMContentLoaded", function () {
      shoutout();
    });
  </script>
</head>

<body>
  <div id="videocontainer" style="position:absolute; left: 0px; top: 0px; width: 100%;z-index:10" ; text-align: center>
    <video id='videoplayer' style="width:100%" autoplay></video>
  </div>
  <div id="imagebox2" style="position:absolute; height: 66%; width: 37.5%;  text-align: center; z-index: 1; left:50%; top:50%; transform: translate(-50%, -50%);">
  </div>
</body>

</html>